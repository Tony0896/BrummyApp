<style>
    .paginate_button.current {
        border: none !important;
        background: #009071 !important;
        border-radius: 8px !important;
        font-weight: bold;
        color: #fff !important;
    }

    .list ul:before {
        display: none !important;
    }

    .list ul:after {
        display: none !important;
    }
    .ts-control {
        border: 0;
        padding: 0;
    }
    .ts-control > input {
        height: auto !important;
    }
    .ts-wrapper.floating.obligatorio.full.has-items {
        border: 2px solid #009071 !important;
        border-radius: 8px !important;
    }
    .grid {
        display: flex;
    }

    .toolbar.calendar-custom-toolbar {
        border-top-left-radius: 10px;
        border-top-right-radius: 10px;
        background-color: #009071;
        color: #fff;
        font-weight: bold;
    }

    .left > a > i.icon.icon-back {
        color: #fff;
    }
    .right > a > i.icon.icon-forward {
        color: #fff;
    }
    .calendar-day.calendar-day-selected .calendar-day-number {
        background-color: #009071;
    }
    .calendar-day .calendar-day-event {
        background-color: rgb(70, 196, 243);
        width: 10px;
        height: 10px;
        border-radius: 50%;
        margin-top: -4px;
    }
    .card-body {
        padding: 1.5rem 1.5rem;
    }
    .text-warning {
        color: #ffaf00 !important;
    }
    /* rtl:end:remove */
    .text-primary {
        color: #1f3bb3 !important;
    }

    .text-secondary {
        color: #f1f1f1 !important;
    }

    .text-success {
        color: #34b1aa !important;
    }

    .text-info {
        color: #52cdff !important;
    }

    .text-danger {
        color: #f95f53 !important;
    }

    .text-light {
        color: #fbfbfb !important;
    }

    .text-dark {
        color: #1e283d !important;
    }

    .text-white {
        color: #ffffff !important;
    }

    .text-body {
        color: #1f1f1f !important;
    }
    .calendar-week-header {
        background: #009071 !important;
        color: #fff !important;
        font-weight: bold;
    }
</style>

<template>
    <div class="page" id="panel-page">
        <div class="navbar" style="height: 5px">
            <div
                class="left top-left"
                style="justify-content: space-between; background-color: #009071; flex-direction: column; height: auto; min-height: 50px"
            >
                <div style="display: flex; flex-direction: row; justify-content: space-between; width: 100%; margin-top: 10px">
                    <div style="width: 33.3%">
                        <a href="#" data-panel="left" style="font-size: 15px" onclick="globalBack()">
                            <i class="icon material-icons md-only" style="margin-left: 15px; font-size: 28px"> arrow_back </i>
                        </a>
                    </div>
                    <div class="title" style="font-size: 18px; margin-left: 15px; width: 33.3%; text-align: center">Citas</div>
                    <div style="width: 33.3%">&nbsp;</div>
                </div>
            </div>
            <div id="marquee_citas" style="background-color: #009071"></div>
        </div>

        <div class="page-content" style="margin-top: 16px">
            <div class="block">
                <div
                    class="card"
                    style="border-radius: 10px; padding: 10px; border-radius: 10px; padding-top: 0px; padding-left: 0px; padding-right: 0px"
                >
                    <input type="hidden" id="fechaActual" />
                    <div class="list accordion-list">
                        <ul>
                            <li class="accordion-item accordion-item-opened">
                                <a
                                    href="#"
                                    class="item-content item-link"
                                    style="background-color: #009071 !important; color: #fff; font-weight: bold; border-radius: 10px"
                                >
                                    <div class="item-inner">
                                        <div class="item-title" id="tnAcordionCalendar"></div>
                                    </div>
                                </a>
                                <div class="accordion-item-content">
                                    <div class="block">
                                        <div class="card" style="border-radius: 10px; margin-top: 20px">
                                            <div id="demo-calendar-inline-container"></div>
                                        </div>
                                        <div style="display: flex; align-items: end; flex-direction: column; margin-right: 20px">
                                            <button class="button button-outline button-round btnBlue" id="irHoy">
                                                <span class="material-icons iconBtn" style="margin-left: 0"> today </span>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
            <div style="display: flex; flex-direction: row; justify-content: space-between">
                <div class="item-title" style="font-weight: bold; margin-inline-start: 40px; margin-top: auto; margin-bottom: auto">
                    Citas Agendadas
                </div>
                <div class="divButton" style="margin-right: 20px">
                    <button class="button button-outline button-round" id="btnNuevaCita">
                        Agregar<span class="material-icons iconBtn"> add_circle_outline </span>
                    </button>
                </div>
            </div>
            <div id="divEventos" style="padding-left: 15px; margin-bottom: 130px"></div>
        </div>
    </div>
</template>

<script>
    return {
        on: {
            pageInit: function () {
                cargaDataMarquee("marquee_citas");
                let url = localStorage.getItem("url");
                let calendar;
                let eventItems = [];
                let events = [];

                let nuevaFecha = new Date();
                const options = { weekday: "long", year: "numeric", month: "long", day: "numeric" };
                let fechaText = nuevaFecha.toLocaleDateString("es-MX", options);

                $("#tnAcordionCalendar").html(fechaText);

                let $$ = Dom7;
                let monthNames = [
                    "Enero",
                    "Febrero",
                    "Marzo",
                    "Abril",
                    "Mayo",
                    "Junio",
                    "Julio",
                    "Agosto",
                    "Septiembre",
                    "Octubre",
                    "Noviembre",
                    "Diciembre",
                ];

                let dayNames = ["Domingo", "Lunes", "Martes", "Miércoles", "Jueves", "Viernes", "Sábado"];
                let dayNamesShort = ["Do", "Lu", "Ma", "Mi", "Ju", "Vi", "Sá"];

                calendar = app.calendar.create({
                    containerEl: "#demo-calendar-inline-container",
                    value: [new Date()],
                    weekHeader: true,
                    touchMove: false,
                    firstDay: 0,
                    dayNames: dayNames,
                    dayNamesShort: dayNamesShort,
                    renderToolbar: function () {
                        return (
                            '<div class="toolbar calendar-custom-toolbar no-shadow">' +
                            '<div class="toolbar-inner">' +
                            '<div class="left">' +
                            '<a href="#" class="link icon-only"><i class="icon icon-back ' +
                            (app.theme === "md" ? "color-white" : "") +
                            '"></i></a>' +
                            "</div>" +
                            '<div class="center"></div>' +
                            '<div class="right">' +
                            '<a href="#" class="link icon-only"><i class="icon icon-forward ' +
                            (app.theme === "md" ? "color-white" : "") +
                            '"></i></a>' +
                            "</div>" +
                            "</div>" +
                            "</div>"
                        );
                    },
                    events: events,
                    on: {
                        init: function (c) {
                            $$(".calendar-custom-toolbar .center").text(monthNames[c.currentMonth] + ", " + c.currentYear);
                            $$(".calendar-custom-toolbar .left .link").on("click", function () {
                                calendar.prevMonth();
                                renderMonthEvents(calendar, calendar.currentMonth + 1, calendar.currentYear);
                            });
                            $$(".calendar-custom-toolbar .right .link").on("click", function () {
                                calendar.nextMonth();
                                renderMonthEvents(calendar, calendar.currentMonth + 1, calendar.currentYear);
                            });
                            cargaEventosMes(c, new Date());
                        },
                        monthYearChangeStart: function (c) {
                            $$(".calendar-custom-toolbar .center").text(monthNames[c.currentMonth] + ", " + c.currentYear);
                        },
                        calendarChange: function (calendar) {
                            recargaEventosDay(calendar, calendar.currentMonth + 1, calendar.currentYear);
                        },
                    },
                });

                $("#irHoy").click(() => {
                    let dateOld = getDateWhitZeros();
                    let monthOld = dateOld.split("-")[1];
                    let yearOld = dateOld.split("-")[0];
                    calendar.setYearMonth(yearOld, monthOld - 1, 0);
                    $(".calendar-day-today").trigger("click");
                });

                function renderMonthEvents(calendar, mes, anio) {
                    let url = localStorage.getItem("url");

                    // axios
                    //     .post(url + "Brummy/views/citas/obtenerEventosMes.php", {
                    //         mes,
                    //         anio,
                    //     })
                    //     .then(function (response) {
                    //         console.log(response);
                    //         if (response.status === 200) {
                    //             let result = response.data.result;
                    //             let html = "";
                    //             if (result == "Sin Datos") {
                    //             } else {
                    //                 result.forEach((data, index) => {
                    //                     let now = new Date(data.fechaCita + " 09:00:00");
                    //                     let today = new Date(now.getFullYear(), now.getMonth(), now.getDate());
                    //                     let currentEvent = events.push({
                    //                         date: today,
                    //                         color: "#00A7B5",
                    //                     });
                    //                 });
                    //                 setTimeout(() => {
                    //                     calendar.update();
                    //                     // console.log("u=>", events);
                    //                 }, 1000);
                    //             }
                    //         }
                    //     })
                    //     .catch(function (error) {
                    //         app.dialog.alert("Algo salió mal", "Aviso");
                    //         console.log(error);
                    //     });

                    $.ajax({
                        method: "POST",
                        dataType: "JSON",
                        url: url + "Brummy/views/citas/obtenerEventosMes.php",
                        data: {
                            mes,
                            anio,
                        },
                    })
                        .done(function (results) {
                            let success = results.success;
                            let result = results.result;

                            switch (success) {
                                case true:
                                    if (result == "Sin Datos") {
                                    } else {
                                        result.forEach((data, index) => {
                                            let now = new Date(data.fechaCita + " 09:00:00");
                                            let today = new Date(now.getFullYear(), now.getMonth(), now.getDate());
                                            let currentEvent = events.push({
                                                date: today,
                                                color: "#00A7B5",
                                            });
                                        });
                                        calendar.update();
                                        console.log("a=>", events);
                                    }
                                    break;
                                case false:
                                    // preloader.hide();
                                    msj.show("Aviso", "Algo salió mal", [{ text1: "OK" }]);
                                    break;
                            }
                        })
                        .fail(function (jqXHR, textStatus, errorThrown) {
                            // preloader.hide();
                            msj.show("Aviso", "Algo salió mal", [{ text1: "OK" }]);
                            console.log("error: " + jqXHR.responseText + "\nEstatus: " + textStatus + "\nError: " + errorThrown);
                        });
                }

                function cargaEventosMes(calendar, date) {
                    let mes = new Date(date).toLocaleDateString("es-MX", {
                        month: "2-digit",
                    });
                    let anio = new Date(date).toLocaleDateString("es-MX", { year: "numeric" });

                    let url = localStorage.getItem("url");
                    // axios
                    //     .post(url + "Brummy/views/citas/obtenerEventosMes.php", {
                    //         mes,
                    //         anio,
                    //     })
                    //     .then(function (response) {
                    //         console.log(response);
                    //         if (response.status === 200) {
                    //             let result = response.data.result;
                    //             if (result == "Sin Datos") {
                    //             } else {
                    //                 result.forEach((data, index) => {
                    //                     let now = new Date(data.fechaCita + " 09:00:00");
                    //                     let today = new Date(now.getFullYear(), now.getMonth(), now.getDate());
                    //                     let currentEvent = events.push({
                    //                         date: today,
                    //                         color: "#00A7B5",
                    //                     });
                    //                 });
                    //                 calendar.update();
                    //                 console.log("a=>", events);
                    //             }
                    //             app.dialog.close();
                    //         }
                    //     })
                    //     .catch(function (error) {
                    //         console.log(error);
                    //         app.dialog.close();
                    //         app.dialog.alert("Algo salió mal", "Aviso");
                    //     })
                    //     .finally(function () {
                    //         // siempre sera ejecutado
                    //     });

                    $.ajax({
                        method: "POST",
                        dataType: "JSON",
                        url: url + "Brummy/views/citas/obtenerEventosMes.php",
                        data: {
                            mes,
                            anio,
                        },
                    })
                        .done(function (results) {
                            let success = results.success;
                            let result = results.result;

                            switch (success) {
                                case true:
                                    if (result == "Sin Datos") {
                                    } else {
                                        result.forEach((data, index) => {
                                            let now = new Date(data.fechaCita + " 09:00:00");
                                            let today = new Date(now.getFullYear(), now.getMonth(), now.getDate());
                                            let currentEvent = events.push({
                                                date: today,
                                                color: "#00A7B5",
                                            });
                                        });
                                        calendar.update();
                                        console.log("a=>", events);
                                    }
                                    break;
                                case false:
                                    // preloader.hide();
                                    msj.show("Aviso", "Algo salió mal", [{ text1: "OK" }]);
                                    break;
                            }
                        })
                        .fail(function (jqXHR, textStatus, errorThrown) {
                            // preloader.hide();
                            msj.show("Aviso", "Algo salió mal", [{ text1: "OK" }]);
                            console.log("error: " + jqXHR.responseText + "\nEstatus: " + textStatus + "\nError: " + errorThrown);
                        });
                }

                function recargaEventosDay(calendar, months, years) {
                    let currentFecha = new Date(calendar.value[0]);

                    const options = { weekday: "long", year: "numeric", month: "long", day: "numeric" };
                    let fechaText = currentFecha.toLocaleDateString("es-MX", options);

                    $("#tnAcordionCalendar").html(fechaText);

                    let year = new Date(currentFecha).toLocaleDateString("es-MX", { year: "numeric" });
                    let month = new Date(currentFecha).toLocaleDateString("es-MX", {
                        month: "2-digit",
                    });
                    let day = new Date(currentFecha).toLocaleDateString("es-MX", { day: "2-digit" });

                    let fecha = year + "-" + month + "-" + day;
                    $("#fechaActual").val(fecha);

                    let url = localStorage.getItem("url");

                    // axios
                    //     .post(url + "Brummy/views/citas/obtenerEventos.php", { fecha })
                    //     .then(function (response) {
                    //         console.log(response);
                    //         if (response.status === 200) {
                    //             let result = response.data.result;
                    //             if (result == "Sin Datos") {
                    //                 $("#divEventos").html(`<div class="row mt-3">
                    //                         <div class="col-md-12 mb-0" style="padding: 0;padding-right: 15px;">
                    //                             <div class="card">
                    //                                 <div class="card-body" style="border-left: 10px solid #009071;border-radius: 10px;">
                    //                                     <div>
                    //                                         <h4 class="mb-0" style="font-weight: normal;"><small class="text-muted" style="margin-bottom: 0px;"> No hay citas agendadas para este día </small></h4>
                    //                                     </div>
                    //                                 </div>
                    //                             </div>
                    //                         </div>
                    //                     </div>`);
                    //             } else {
                    //                 let html = "",
                    //                     colorText = "",
                    //                     TextEstatus = "",
                    //                     temperamento = "",
                    //                     indicadorCliente = "";
                    //                 result.forEach((data, index) => {
                    //                     TextEstatus = "";
                    //                     if (data.estatus == 1) {
                    //                         TextEstatus = `<h4 class="card-title text-success" style="margin: 0px;"><strong>${data.flagEstatus}</strong></h4>`;
                    //                         colorText = "#009071";
                    //                     } else if (data.estatus == 2) {
                    //                         TextEstatus = `<h4 class="card-title text-primary" style="margin: 0px;"><strong>${data.flagEstatus}</strong></h4>`;
                    //                         colorText = "#0277BD";
                    //                     } else if (data.estatus == 3) {
                    //                         TextEstatus = `<h4 class="card-title text-danger" style="margin: 0px;"><strong>${data.flagEstatus}</strong></h4>`;
                    //                         colorText = "#F95F53";
                    //                     } else if (data.estatus == 4) {
                    //                         TextEstatus = `<h4 class="card-title text-warning" style="margin: 0px;"><strong>${data.flagEstatus}</strong></h4>`;
                    //                         colorText = "#FFAF00";
                    //                     }

                    //                     if (data.temperamento == "verde") {
                    //                         temperamento = `#27AE60`;
                    //                     } else if (data.temperamento == "amarilo") {
                    //                         temperamento = `#ffb02e`;
                    //                     } else if (data.temperamento == "rojo") {
                    //                         temperamento = `#ff0300`;
                    //                     }

                    //                     if (data.indicadorCliente == "verde") {
                    //                         indicadorCliente = `#27AE60`;
                    //                     } else if (data.indicadorCliente == "amarilo") {
                    //                         indicadorCliente = `#ffb02e`;
                    //                     } else if (data.indicadorCliente == "rojo") {
                    //                         indicadorCliente = `#ff0300`;
                    //                     }

                    //                     html += `
                    //                             <div class="row mt-3">
                    //                                 <div class="col-md-12 mb-0" style="padding: 0;padding-right: 15px;">
                    //                                     <div class="card" id="card_evt_${data.ID}">
                    //                                         <div class="card-body" style="border-left: 10px solid ${colorText};border-radius: 10px; padding: 1rem 1.5rem;">
                    //                                             <div class="row">
                    //                                                 <div class="col-60">
                    //                                                     <div class="row">
                    //                                                         <div class="col-md-12 my-2">
                    //                                                             <h4 class="card-title" style="display: flex;flex-direction: row;align-items: center;">
                    //                                                                 <div> <span class="material-icons" style="font-size: 18px;color: ${indicadorCliente}; margin-left: 5px; margin-right: 5px;"> fiber_manual_record </span> </div>
                    //                                                         ${data.nombreCita} Y ${data.nombreMascota}
                    //                                                                 <div> <span class="material-icons" style="font-size: 18px;color: ${temperamento}; margin-left: 5px;"> fiber_manual_record </span> </div>
                    //                                                             </h4> <div id="div_evt_${data.ID}"> ${TextEstatus} </div></div>
                    //                                                             <div class="col-md-12 my-2">
                    //                                                                 <span class="capitalize"> ${
                    //                                                                     String(data.comentariosCita).trim()
                    //                                                                         ? String(data.comentariosCita).trim()
                    //                                                                         : "Sin comentarios adicionales"
                    //                                                                 }</span>
                    //                                                             </div>
                    //                                                     </div>
                    //                                                 </div>
                    //                                                 <div class="col-40" style="display: flex;flex-direction: column;">
                    //                                                     <div style="display: flex;margin-bottom: 12px;"> <span class="material-icons" style="margin-right: 15px;color: #0277bd;"> schedule </span> <strong class="capitalize" style="font-weight: 500;"> ${
                    //                                                         String(data.horaCita).split(":")[0]
                    //                                                     }:${String(data.horaCita).split(":")[1]} </strong></div>
                    //                                                     <div style="display: flex;margin-bottom: 12px;"> <span class="material-icons" style="margin-right: 15px;color: #0277bd;"> checklist </span> <strong class="capitalize" style="font-weight: 500;"> ${String(
                    //                                                         data.motivoCita
                    //                                                     ).trim()} </strong> </div>
                    //                                                     <div class="col-md-4 my-0" style="display: flex;">
                    //                                                         <div class="divButton" style="margin-right: 20px">
                    //                                                             <button class="button button-outline button-round btnBlue" onclick="marcarCita(${
                    //                                                                 data.ID
                    //                                                             })" style="margin-right: 20px;">
                    //                                                                 <span class="material-icons iconBtn" style="margin-left: 0;"> date_range </span>
                    //                                                             </button>

                    //                                                             <button class="button button-outline button-round btnGreen" onclick="generarLinkEncuesta(${
                    //                                                                 data.ID
                    //                                                             })">
                    //                                                                 <span class="material-icons iconBtn" style="margin-left: 0;"> link </span>
                    //                                                             </button>
                    //                                                         </div>
                    //                                                         <input id="foo_${data.ID}" value="" style="opacity: 0;height: 0;">
                    //                                                         <button class="btn" data-clipboard-target="#foo_${data.ID}" id="btn_foo_${
                    //                         data.ID
                    //                     }" style="height: 0;padding: 0;opacity: 0;"></button>
                    //                                                         <input type="hidden" id="input_FK_mascota_${data.ID}" value="${
                    //                         data.FKnombreMascota
                    //                     }" />
                    //                                                         <input type="hidden" id="input_nombre_${data.ID}" value="${
                    //                         data.nombreMascota
                    //                     }" />
                    //                                                     </div>
                    //                                                 </div>
                    //                                             </div>
                    //                                         </div>
                    //                                     </div>
                    //                                 </div>
                    //                             </div>`;
                    //                 });
                    //                 $("#divEventos").html(html);
                    //             }
                    //         }
                    //     })
                    //     .catch(function (error) {
                    //         console.log(error);
                    //         app.dialog.close();
                    //         app.dialog.alert("Algo salió mal", "Aviso");
                    //     })
                    //     .finally(function () {
                    //         // siempre sera ejecutado
                    //     });

                    $.ajax({
                        method: "POST",
                        dataType: "JSON",
                        url: url + "Brummy/views/citas/obtenerEventos.php",
                        data: { fecha },
                    })
                        .done(function (results) {
                            let success = results.success;
                            let result = results.result;

                            switch (success) {
                                case true:
                                    if (result == "Sin Datos") {
                                        $("#divEventos").html(`<div class="row mt-3">
                                                            <div class="col-md-12 mb-0" style="padding: 0;padding-right: 15px;">
                                                                <div class="card">
                                                                    <div class="card-body" style="border-left: 10px solid #009071;border-radius: 10px;">
                                                                        <div>
                                                                            <h4 class="mb-0" style="font-weight: normal;"><small class="text-muted" style="margin-bottom: 0px;"> No hay citas agendadas para este día </small></h4>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>`);
                                    } else {
                                        let html = "",
                                            colorText = "",
                                            TextEstatus = "",
                                            temperamento = "",
                                            indicadorCliente = "";
                                        result.forEach((data, index) => {
                                            TextEstatus = "";
                                            if (data.estatus == 1) {
                                                TextEstatus = `<h4 class="card-title text-success" style="margin: 0px;"><strong>${data.flagEstatus}</strong></h4>`;
                                                colorText = "#009071";
                                            } else if (data.estatus == 2) {
                                                TextEstatus = `<h4 class="card-title text-primary" style="margin: 0px;"><strong>${data.flagEstatus}</strong></h4>`;
                                                colorText = "#0277BD";
                                            } else if (data.estatus == 3) {
                                                TextEstatus = `<h4 class="card-title text-danger" style="margin: 0px;"><strong>${data.flagEstatus}</strong></h4>`;
                                                colorText = "#F95F53";
                                            } else if (data.estatus == 4) {
                                                TextEstatus = `<h4 class="card-title text-warning" style="margin: 0px;"><strong>${data.flagEstatus}</strong></h4>`;
                                                colorText = "#FFAF00";
                                            }

                                            if (data.temperamento == "verde") {
                                                temperamento = `#27AE60`;
                                            } else if (data.temperamento == "amarilo") {
                                                temperamento = `#ffb02e`;
                                            } else if (data.temperamento == "rojo") {
                                                temperamento = `#ff0300`;
                                            }

                                            if (data.indicadorCliente == "verde") {
                                                indicadorCliente = `#27AE60`;
                                            } else if (data.indicadorCliente == "amarilo") {
                                                indicadorCliente = `#ffb02e`;
                                            } else if (data.indicadorCliente == "rojo") {
                                                indicadorCliente = `#ff0300`;
                                            }

                                            html += `
                                                <div class="row mt-3">
                                                    <div class="col-md-12 mb-0" style="padding: 0;padding-right: 15px;">
                                                        <div class="card" id="card_evt_${data.ID}">
                                                            <div class="card-body" style="border-left: 10px solid ${colorText};border-radius: 10px; padding: 1rem 1.5rem;">
                                                                <div class="row">
                                                                    <div class="col-60">
                                                                        <div class="row">
                                                                            <div class="col-md-12 my-2">
                                                                                <h4 class="card-title" style="display: flex;flex-direction: row;align-items: center;">
                                                                                    <div> <span class="material-icons" style="font-size: 18px;color: ${indicadorCliente}; margin-left: 5px; margin-right: 5px;"> fiber_manual_record </span> </div>
                                                                            ${data.nombreCita} Y ${data.nombreMascota}
                                                                                    <div> <span class="material-icons" style="font-size: 18px;color: ${temperamento}; margin-left: 5px;"> fiber_manual_record </span> </div>
                                                                                </h4> <div id="div_evt_${data.ID}"> ${TextEstatus} </div></div>
                                                                                <div class="col-md-12 my-2">
                                                                                    <span class="capitalize"> ${
                                                                                        String(data.comentariosCita).trim()
                                                                                            ? String(data.comentariosCita).trim()
                                                                                            : "Sin comentarios adicionales"
                                                                                    }</span>
                                                                                </div>
                                                                        </div>
                                                                    </div>
                                                                    <div class="col-40" style="display: flex;flex-direction: column;">
                                                                        <div style="display: flex;margin-bottom: 12px;"> <span class="material-icons" style="margin-right: 15px;color: #0277bd;"> schedule </span> <strong class="capitalize" style="font-weight: 500;"> ${
                                                                            String(data.horaCita).split(":")[0]
                                                                        }:${String(data.horaCita).split(":")[1]} </strong></div>
                                                                        <div style="display: flex;margin-bottom: 12px;"> <span class="material-icons" style="margin-right: 15px;color: #0277bd;"> checklist </span> <strong class="capitalize" style="font-weight: 500;"> ${String(
                                                                            data.motivoCita
                                                                        ).trim()} </strong> </div>
                                                                        <div class="col-md-4 my-0" style="display: flex;">
                                                                            <div class="divButton" style="margin-right: 20px">
                                                                                <button class="button button-outline button-round btnBlue" onclick="marcarCita(${
                                                                                    data.ID
                                                                                })" style="margin-right: 20px;">
                                                                                    <span class="material-icons iconBtn" style="margin-left: 0;"> date_range </span>
                                                                                </button>

                                                                                <button class="button button-outline button-round btnGreen" onclick="generarLinkEncuesta(${
                                                                                    data.ID
                                                                                })">
                                                                                    <span class="material-icons iconBtn" style="margin-left: 0;"> link </span>
                                                                                </button>
                                                                            </div>
                                                                            <input id="foo_${data.ID}" value="" style="opacity: 0;height: 0;">
                                                                            <button class="btn" data-clipboard-target="#foo_${data.ID}" id="btn_foo_${
                                                data.ID
                                            }" style="height: 0;padding: 0;opacity: 0;"></button>
                                                                            <input type="hidden" id="input_FK_mascota_${data.ID}" value="${
                                                data.FKnombreMascota
                                            }" />
                                                                            <input type="hidden" id="input_nombre_${data.ID}" value="${
                                                data.nombreMascota
                                            }" />
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>`;
                                        });
                                        $("#divEventos").html(html);
                                    }
                                    break;
                                case false:
                                    // preloader.hide();
                                    msj.show("Aviso", "Algo salió mal", [{ text1: "OK" }]);
                                    break;
                            }
                        })
                        .fail(function (jqXHR, textStatus, errorThrown) {
                            // preloader.hide();
                            msj.show("Aviso", "Algo salió mal", [{ text1: "OK" }]);
                            console.log("error: " + jqXHR.responseText + "\nEstatus: " + textStatus + "\nError: " + errorThrown);
                        });
                }

                $("#btnNuevaCita").click(() => {
                    let url = localStorage.getItem("url");
                    let controlMascotas;
                    let html = "";
                    axios
                        .get(url + "Brummy/views/clientes/obtenerClientes.php", {})
                        .then(function (response) {
                            console.log(response);
                            if (response.status === 200) {
                                let result = response.data.result;
                                if (result == "Sin Datos") {
                                } else {
                                    result.forEach((data, index) => {
                                        html += `<option value="${data.ID}">${data.nombre} ${data.apellidoP} ${data.apellidoM}</option>`;
                                    });
                                    axios
                                        .get(url + "Brummy/views/catalogos/obtenerMotivos.php", {})
                                        .then(function (response) {
                                            console.log(response);
                                            if (response.status === 200) {
                                                let result = response.data.result;
                                                let html3 = "";
                                                if (result == "Sin Datos") {
                                                } else {
                                                    result.forEach((data, index) => {
                                                        html3 += `<option value='${data.ID}'> ${data.motivoCita} </option>`;
                                                    });
                                                }

                                                let modalTemplate = app.popup.create({
                                                    content: `<div class="sheet-modal demo-sheet">
                                                            <div class="swipe-handler"> <h1 class="link sheet-close" style="text-align: end;margin-right: 15px;display: block;margin-top: 10px;">
                                                                <span class="material-icons" style="font-size: 35px; color: #FF0037; "> cancel </span></h1>
                                                            </div>
                                                            <div class="sheet-modal-inner">
                                                                <div class="page-content">
                                                                    <div class="block" style="margin-top: 60px;align-items: center;display: flex;flex-direction: column;">
                                                                        <div id="nuevaCita" style=" width: 100%; ">
                                                                            <div class="list list-strong-ios list-dividers-ios inset-ios">
                                                                                <ul>
                                                                                    <li class="item-content item-input item-input-outline">
                                                                                        <div class="item-inner">
                                                                                            <div class="item-title item-floating-label">Cliente</div>
                                                                                            <div class="item-input-wrap">
                                                                                                <select class="floating obligatorio input-focused " type="text" placeholder="Cliente" id="nombreCita" name="Cliente">
                                                                                                    <option value="">Selecciona una opción</option>
                                                                                                    ${html}
                                                                                                </select>
                                                                                            </div>
                                                                                        </div>
                                                                                    </li>

                                                                                    <li class="item-content item-input item-input-outline">
                                                                                        <div class="item-inner">
                                                                                            <div class="item-title item-floating-label">Nombre Mascota</div>
                                                                                            <div class="item-input-wrap">
                                                                                                <select class="floating obligatorio input-focused " type="text" placeholder="Nombre Mascota" id="nombreMascota" name="Nombre Mascota">
                                                                                                    <option value="">Selecciona una opción</option>
                                                                                                </select>
                                                                                            </div>
                                                                                        </div>
                                                                                    </li>

                                                                                    <li class="item-content item-input item-input-outline">
                                                                                        <div class="item-inner">
                                                                                            <div class="item-title item-floating-label">Fecha Cita</div>
                                                                                            <div class="item-input-wrap">
                                                                                                <input class="floating obligatorio input-focused " type="date" placeholder="Fecha Cita" id="fechaCita" name="Fecha Cita">
                                                                                                <span class="input-clear-button"></span>
                                                                                            </div>
                                                                                        </div>
                                                                                    </li>

                                                                                    <li class="item-content item-input item-input-outline">
                                                                                        <div class="item-inner">
                                                                                            <div class="item-title item-floating-label">Hora Cita</div>
                                                                                            <div class="item-input-wrap">
                                                                                                <input class="floating obligatorio input-focused " type="time" placeholder="Hora Cita" id="horaCita" name="Hora Cita">
                                                                                                <span class="input-clear-button"></span>
                                                                                            </div>
                                                                                        </div>
                                                                                    </li>

                                                                                    <li class="item-content item-input item-input-outline">
                                                                                        <div class="item-inner">
                                                                                            <div class="item-title item-floating-label">Motivo de Cita</div>
                                                                                            <div class="item-input-wrap">
                                                                                                <select class="floating obligatorio input-focused " type="text" placeholder="Motivo de Cita" id="motivoCita" name="Motivo de Cita">
                                                                                                    <option value="">Selecciona una opción</option>
                                                                                                    ${html3}
                                                                                                </select>
                                                                                            </div>
                                                                                        </div>
                                                                                    </li>

                                                                                    <li class="item-content item-input item-input-outline">
                                                                                        <div class="item-inner">
                                                                                            <div class="item-title item-floating-label">Comentarios</div>
                                                                                            <div class="item-input-wrap">
                                                                                                <input class="floating input-focused " type="text" placeholder="Comentarios" id="comentariosCita" name="Comentarios">
                                                                                                <span class="input-clear-button"></span>
                                                                                            </div>
                                                                                        </div>
                                                                                    </li>

                                                                                    <div class="checkbox-wrapper-46" style="margin: 22px 0px 12px 8px;padding-left: 15px;">
                                                                                        <input type="checkbox" id="cbx-46" class="inp-cbx" onchange="muestraDomicilio()"/>
                                                                                        <label for="cbx-46" class="cbx">
                                                                                            <span style="transform: scale(1.3);">
                                                                                                <svg viewBox="0 0 12 10" height="10px" width="12px">
                                                                                                    <polyline points="1.5 6 4.5 9 10.5 1"></polyline>
                                                                                                </svg>
                                                                                            </span>
                                                                                            <span>¿Es Servicio a domicilio?</span>
                                                                                        </label>
                                                                                    </div>

                                                                                    <div id="div_servicioDomicilio" style="display: none;padding: 10px;margin: 10px 0px;" class="card2">
                                                                                        <li class="item-content item-input item-input-outline" id="LIcalleDomi_input">
                                                                                            <div class="item-inner">
                                                                                                <div class="item-title item-floating-label">Calle</div>
                                                                                                <div class="item-input-wrap">
                                                                                                    <input class="floating input-focused " type="text" placeholder="Calle" id="calleDomi_input" name="Calle">
                                                                                                    <span class="input-clear-button"></span>
                                                                                                </div>
                                                                                            </div>
                                                                                        </li>

                                                                                        <li class="item-content item-input item-input-outline" id="LInumeroDomi_input">
                                                                                            <div class="item-inner">
                                                                                                <div class="item-title item-floating-label">Número</div>
                                                                                                <div class="item-input-wrap">
                                                                                                    <input class="floating input-focused " type="text" placeholder="Número" id="numeroDomi_input" name="Número">
                                                                                                    <span class="input-clear-button"></span>
                                                                                                </div>
                                                                                            </div>
                                                                                        </li>

                                                                                        <li class="item-content item-input item-input-outline" id="LIcpDomi_input">
                                                                                            <div class="item-inner">
                                                                                                <div class="item-title item-floating-label">C.P.</div>
                                                                                                <div class="item-input-wrap">
                                                                                                    <input class="floating input-focused " type="text" placeholder="C.P." id="cpDomi_input" name="C.P.">
                                                                                                    <span class="input-clear-button"></span>
                                                                                                </div>
                                                                                            </div>
                                                                                        </li>

                                                                                        <li class="item-content item-input item-input-outline" id="LIcolDomi_input">
                                                                                            <div class="item-inner">
                                                                                                <div class="item-title item-floating-label">Colonia</div>
                                                                                                <div class="item-input-wrap">
                                                                                                    <input class="floating input-focused " type="text" placeholder="Colonia" id="colDomi_input" name="Colonia">
                                                                                                    <span class="input-clear-button"></span>
                                                                                                </div>
                                                                                            </div>
                                                                                        </li>

                                                                                        <li class="item-content item-input item-input-outline" id="LImunicipioDomi_input">
                                                                                            <div class="item-inner">
                                                                                                <div class="item-title item-floating-label">Municipio/Alcaldía</div>
                                                                                                <div class="item-input-wrap">
                                                                                                    <input class="floating input-focused " type="text" placeholder="Municipio/Alcaldía" id="municipioDomi_input" name="Municipio/Alcaldía">
                                                                                                    <span class="input-clear-button"></span>
                                                                                                </div>
                                                                                            </div>
                                                                                        </li>

                                                                                        <li class="item-content item-input item-input-outline" id="LIestadoDomi_input">
                                                                                            <div class="item-inner">
                                                                                                <div class="item-title item-floating-label">Estado</div>
                                                                                                <div class="item-input-wrap">
                                                                                                    <input class="floating input-focused " type="text" placeholder="Estado" id="estadoDomi_input" name="Estado">
                                                                                                    <span class="input-clear-button"></span>
                                                                                                </div>
                                                                                            </div>
                                                                                        </li>

                                                                                    </div>
                                                                                    <div class="checkbox-wrapper-46" style="margin: 22px 0px 12px 8px;padding-left: 15px;">
                                                                                        <input type="checkbox" id="cbx-47" class="inp-cbx" onchange="muestraRecurrencia()"/>
                                                                                        <label for="cbx-47" class="cbx">
                                                                                            <span style="transform: scale(1.3);">
                                                                                                <svg viewBox="0 0 12 10" height="10px" width="12px">
                                                                                                    <polyline points="1.5 6 4.5 9 10.5 1"></polyline>
                                                                                                </svg>
                                                                                            </span>
                                                                                            <span>¿El cliente pide recordar?</span>
                                                                                        </label>
                                                                                    </div>

                                                                                    <div id="div_Recurrencia" style="display: none;padding: 15px 10px 25px;margin: 10px 0px;" class="card2">
                                                                                        <li class="item-content item-input item-input-outline" id="LIeachRecurrencia_input">
                                                                                            <div class="item-inner">
                                                                                                <div class="item-title item-floating-label">Recurrencia: </div>
                                                                                                <div class="item-input-wrap">
                                                                                                    <select class="floating input-focused" name="¿Cada cuánto?" placeholder="¿Cada cuánto?" id="eachRecurrencia_input" style="background-color: rgb(255, 255, 255);width:100%;padding-top: 0 !important;padding-bottom: 0 !important;">
                                                                                                        <option value=""> - - </option>
                                                                                                        <option value="1">Única ocasión</option>
                                                                                                        <option value="7">Cada semana</option><!--  -->
                                                                                                        <option value="14">Cada 2 semanas</option><!--  -->
                                                                                                        <option value="30">Cada mes</option>
                                                                                                    </select>
                                                                                                </div>
                                                                                            </div>
                                                                                        </li>

                                                                                        <li class="item-content item-input item-input-outline" id="div_fechaRecurrencia" style="display:none;">
                                                                                            <div class="item-inner">
                                                                                                <div class="item-title item-floating-label">Fecha: </div>
                                                                                                <div class="item-input-wrap">
                                                                                                   <input name="Fecha" type="date" class="floating input-focused" id="fechaCitaRecurrencia" autocomplete="off" />
                                                                                                </div>
                                                                                            </div>
                                                                                        </li>
                                                                                    </div>
                                                                                </ul>
                                                                            </div>
                                                                        </div>

                                                                        <button class="button button-outline button-round" id="btnGuardarCita">
                                                                            Guardar <span class="material-icons iconBtn"> save </span>
                                                                        </button>

                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>`,
                                                    swipeToClose: false,
                                                    closeByOutsideClick: false,
                                                    closeByBackdropClick: false,
                                                    closeOnEscape: false,
                                                    on: {
                                                        open: function (popup) {
                                                            new TomSelect("#nombreCita", {
                                                                create: false,
                                                            });

                                                            new TomSelect("#motivoCita", {
                                                                create: false,
                                                            });

                                                            controlMascotas = new TomSelect("#nombreMascota", {
                                                                create: false,
                                                            });

                                                            $("#nombreCita").change(() => {
                                                                let FK_dueno = $("#nombreCita").val();
                                                                if (FK_dueno) {
                                                                    // axios
                                                                    //     .post(url + "Brummy/views/mascotas/obtenerMascotasDuenios.php", { FK_dueno })
                                                                    //     .then(function (response) {
                                                                    //         console.log(response);
                                                                    //         if (response.status === 200) {
                                                                    //             let result = response.data.result;
                                                                    //             let html2 = "<option value=''> - - </option>";
                                                                    //             if (result == "Sin Datos") {
                                                                    //                 $("#nombreMascota").html(html2);
                                                                    //             } else {
                                                                    //                 result.forEach((data, index) => {
                                                                    //                     html2 += `<option value='${data.ID}'> ${data.nombre} </option>`;
                                                                    //                 });

                                                                    //                 $("#nombreMascota").html(html2);
                                                                    //                 controlMascotas.clear();
                                                                    //                 controlMascotas.clearOptions();
                                                                    //                 controlMascotas.sync();
                                                                    //             }
                                                                    //             app.dialog.close();
                                                                    //         }
                                                                    //     })
                                                                    //     .catch(function (error) {
                                                                    //         console.log(error);
                                                                    //         app.dialog.close();
                                                                    //         app.dialog.alert("Algo salió mal", "Aviso");
                                                                    //     })
                                                                    //     .finally(function () {
                                                                    //         // siempre sera ejecutado
                                                                    //     });
                                                                    $.ajax({
                                                                        method: "POST",
                                                                        dataType: "JSON",
                                                                        url: url + "Brummy/views/mascotas/obtenerMascotasDuenios.php",
                                                                        data: { FK_dueno },
                                                                    })
                                                                        .done(function (results) {
                                                                            let success = results.success;
                                                                            let result = results.result;

                                                                            switch (success) {
                                                                                case true:
                                                                                    let html2 = "<option value=''> - - </option>";
                                                                                    if (result == "Sin Datos") {
                                                                                        $("#nombreMascota").html(html2);
                                                                                    } else {
                                                                                        result.forEach((data, index) => {
                                                                                            html2 += `<option value='${data.ID}'> ${data.nombre} </option>`;
                                                                                        });

                                                                                        $("#nombreMascota").html(html2);
                                                                                        controlMascotas.clear();
                                                                                        controlMascotas.clearOptions();
                                                                                        controlMascotas.sync();
                                                                                    }
                                                                                    app.dialog.close();
                                                                                    break;
                                                                                case false:
                                                                                    // preloader.hide();
                                                                                    msj.show("Aviso", "Algo salió mal", [{ text1: "OK" }]);
                                                                                    break;
                                                                            }
                                                                        })
                                                                        .fail(function (jqXHR, textStatus, errorThrown) {
                                                                            // preloader.hide();
                                                                            msj.show("Aviso", "Algo salió mal", [{ text1: "OK" }]);
                                                                            console.log(
                                                                                "error: " +
                                                                                    jqXHR.responseText +
                                                                                    "\nEstatus: " +
                                                                                    textStatus +
                                                                                    "\nError: " +
                                                                                    errorThrown
                                                                            );
                                                                        });
                                                                    getDireecionCliente(FK_dueno);
                                                                } else {
                                                                    $("#nombreMascota").html(`<option value=''> - - </option>`);
                                                                    controlMascotas.clear();
                                                                    controlMascotas.clearOptions();
                                                                    controlMascotas.sync();
                                                                }
                                                            });

                                                            $("#btnGuardarCita").click(() => {
                                                                validacioesCita();
                                                            });

                                                            $("#eachRecurrencia_input").change(() => {
                                                                if ($("#eachRecurrencia_input").val() == 1) {
                                                                    $("#div_fechaRecurrencia").css("display", "flex");
                                                                } else {
                                                                    $("#div_fechaRecurrencia").css("display", "none");
                                                                }
                                                            });
                                                        },
                                                    },
                                                });

                                                modalTemplate.open();
                                                app.dialog.close();
                                            }
                                        })
                                        .catch(function (error) {
                                            console.log(error);
                                            app.dialog.close();
                                            app.dialog.alert("Algo salió mal", "Aviso");
                                        })
                                        .finally(function () {
                                            // siempre sera ejecutado
                                        });
                                }
                            }
                        })
                        .catch(function (error) {
                            console.log(error);
                            app.dialog.close();
                            app.dialog.alert("Algo salió mal", "Aviso");
                        })
                        .finally(function () {
                            // siempre sera ejecutado
                        });
                });

                function validacioesCita() {
                    let url = localStorage.getItem("url");
                    let values = get_datos_completos("nuevaCita");
                    let response = values.response;
                    let valido = values.valido;
                    let fecha_actual_val = new Date();

                    const year = fecha_actual_val.getFullYear();
                    const month = String(fecha_actual_val.getMonth() + 1).padStart(2, "0");
                    const day = String(fecha_actual_val.getDate()).padStart(2, "0");

                    let fecha_actual_format = `${year}-${month}-${day}`;

                    if (valido) {
                        let fechaCita = $("#fechaCita").val();
                        let horaCita = $("#horaCita").val();

                        if (fechaCita < fecha_actual_format) {
                            console.log("La fecha seleccionada es menor a la actual");
                            app.dialog.alert("La fecha de la cita no puede ser menor a la actual", "Aviso");
                            // msj.show("Aviso", "La fecha de la cita no puede ser menor a la actual", [{ text1: "OK" }]);
                            // preloader.hide();
                            return false;
                        }

                        if ($("#cbx-46").prop("checked")) {
                            let calleDomi = String($("#calleDomi_input").val()).trim();
                            let numeroDomi = String($("#numeroDomi_input").val()).trim();
                            let cpDomi = String($("#cpDomi_input").val()).trim();
                            let colDomi = String($("#colDomi_input").val()).trim();
                            let municipioDomi = String($("#municipioDomi_input").val()).trim();
                            let estadoDomi = String($("#estadoDomi_input").val()).trim();

                            calleDomi.replaceAll("'", '"');
                            numeroDomi.replaceAll("'", '"');
                            cpDomi.replaceAll("'", '"');
                            colDomi.replaceAll("'", '"');
                            municipioDomi.replaceAll("'", '"');
                            estadoDomi.replaceAll("'", '"');

                            if (!calleDomi || !numeroDomi || !cpDomi || !colDomi || !municipioDomi || !estadoDomi) {
                                app.dialog.alert("El domicilio esta incompleto", "Aviso");
                                return false;
                            }
                        }

                        // axios
                        //     .post(url + "Brummy/views/citas/validaCita.php", { fechaCita, horaCita })
                        //     .then(function (response) {
                        //         console.log(response);
                        //         if (response.status === 200) {
                        //             let result = response.data.result;
                        //             if (result == "Sin Datos") {
                        //                 guardarCita();
                        //             } else {
                        //                 let Texto = "";
                        //                 result.forEach((data, index) => {
                        //                     Texto = ` ${data.nombreCita} y ${data.nombreMascota} que podria empalmarse. ¿Deseas continuar?`;
                        //                 });
                        //                 app.dialog
                        //                     .create({
                        //                         title: "Hay una cita ya agendada de: " + Texto,
                        //                         buttons: [
                        //                             {
                        //                                 text: "Cancelar",
                        //                                 onClick: function () {
                        //                                     console.log("Cancelar");
                        //                                 },
                        //                             },
                        //                             {
                        //                                 text: "OK",
                        //                                 onClick: function () {
                        //                                     guardarCita();
                        //                                 },
                        //                             },
                        //                         ],
                        //                     })
                        //                     .open();
                        //             }
                        //         }
                        //     })
                        //     .catch(function (error) {
                        //         console.log(error);
                        //         app.dialog.close();
                        //         app.dialog.alert("Algo salió mal", "Aviso");
                        //     })
                        //     .finally(function () {
                        //         // siempre sera ejecutado
                        //     });

                        if ($("#cbx-47").prop("checked")) {
                            if (!$("#eachRecurrencia_input").val()) {
                                msj.show("Aviso", "Debes indicar la recurrencia", [{ text1: "OK" }]);
                                return false;
                            }

                            if ($("#eachRecurrencia_input").val() == 1) {
                                if (!$("#fechaCitaRecurrencia").val()) {
                                    msj.show("Aviso", "Debes indicar la fecha para recordar", [{ text1: "OK" }]);
                                    return false;
                                }
                            }
                        }

                        $.ajax({
                            method: "POST",
                            dataType: "JSON",
                            url: url + "Brummy/views/citas/validaCita.php",
                            data: { fechaCita, horaCita },
                        })
                            .done(function (results) {
                                let success = results.success;
                                let result = results.result;

                                switch (success) {
                                    case true:
                                        if (result == "Sin Datos") {
                                            guardarCita();
                                        } else {
                                            let Texto = "";
                                            result.forEach((data, index) => {
                                                Texto = ` ${data.nombreCita} y ${data.nombreMascota} que podria empalmarse. ¿Deseas continuar?`;
                                            });
                                            app.dialog
                                                .create({
                                                    title: "Hay una cita ya agendada de: " + Texto,
                                                    buttons: [
                                                        {
                                                            text: "Cancelar",
                                                            onClick: function () {
                                                                console.log("Cancelar");
                                                            },
                                                        },
                                                        {
                                                            text: "OK",
                                                            onClick: function () {
                                                                guardarCita();
                                                            },
                                                        },
                                                    ],
                                                })
                                                .open();
                                        }
                                        break;
                                    case false:
                                        // preloader.hide();
                                        msj.show("Aviso", "Algo salió mal", [{ text1: "OK" }]);
                                        break;
                                }
                            })
                            .fail(function (jqXHR, textStatus, errorThrown) {
                                // preloader.hide();
                                msj.show("Aviso", "Algo salió mal", [{ text1: "OK" }]);
                                console.log("error: " + jqXHR.responseText + "\nEstatus: " + textStatus + "\nError: " + errorThrown);
                            });
                    } else {
                        let html =
                            '<span style="font-weight: 900;">Debes llenar estos campos para poder guardar:</span> <br> <ul style="text-align: left; margin-left: 15px; font-style: italic; margin-top: 15px;"> ';
                        response.forEach((data) => {
                            html += `<li style="list-style: disc;">${data}.</li> `;
                        });
                        html += `</ul>`;
                        // Swal.fire({ icon: "warning", title: "", html: html });
                        swal({
                            type: "warning",
                            title: "",
                            text: html,
                            html: true,
                        });
                    }
                }

                function guardarCita() {
                    let FKnombreCita = $("#nombreCita").val();
                    let nombreCita = String($("#nombreCita").find("option:selected").text());
                    let FKnombreMascota = $("#nombreMascota").val();
                    let nombreMascota = String($("#nombreMascota").find("option:selected").text());
                    let fechaCita = $("#fechaCita").val();
                    let horaCita = $("#horaCita").val();
                    let motivoCita = $("#motivoCita").find("option:selected").text();
                    let comentariosCita = String($("#comentariosCita").val());
                    let FKMotivo = $("#motivoCita").val();
                    let url = localStorage.getItem("url");

                    nombreCita.replaceAll("'", '"');
                    nombreMascota.replaceAll("'", '"');
                    motivoCita.replaceAll("'", '"');
                    comentariosCita.replaceAll("'", '"');

                    let calleDomi = "";
                    let numeroDomi = "";
                    let cpDomi = "";
                    let colDomi = "";
                    let municipioDomi = "";
                    let estadoDomi = "";
                    let domicilio = 0;
                    if ($("#cbx-46").prop("checked")) {
                        domicilio = 1;
                        calleDomi = String($("#calleDomi_input").val()).trim();
                        numeroDomi = String($("#numeroDomi_input").val()).trim();
                        cpDomi = String($("#cpDomi_input").val()).trim();
                        colDomi = String($("#colDomi_input").val()).trim();
                        municipioDomi = String($("#municipioDomi_input").val()).trim();
                        estadoDomi = String($("#estadoDomi_input").val()).trim();

                        calleDomi.replaceAll("'", '"');
                        numeroDomi.replaceAll("'", '"');
                        cpDomi.replaceAll("'", '"');
                        colDomi.replaceAll("'", '"');
                        municipioDomi.replaceAll("'", '"');
                        estadoDomi.replaceAll("'", '"');
                    }

                    // axios
                    //     .post(url + "Brummy/views/citas/guardarCita.php", {
                    //         FKnombreCita,
                    //         nombreCita,
                    //         FKnombreMascota,
                    //         nombreMascota,
                    //         fechaCita,
                    //         horaCita,
                    //         motivoCita,
                    //         comentariosCita,
                    //         FKMotivo,
                    //         calleDomi,
                    //         numeroDomi,
                    //         cpDomi,
                    //         colDomi,
                    //         municipioDomi,
                    //         estadoDomi,
                    //         domicilio,
                    //     })
                    //     .then(function (response) {
                    //         console.log(response);
                    //         if (response.status === 200) {
                    //             $(".sheet-close").trigger("click");
                    //             app.dialog.alert("Guardado correctamente", "Aviso");
                    //             validaEventos(fechaCita);
                    //             app.dialog.close();
                    //         }
                    //     })
                    //     .catch(function (error) {
                    //         console.log(error);
                    //         app.dialog.close();
                    //         app.dialog.alert("Algo salió mal", "Aviso");
                    //     })
                    //     .finally(function () {
                    //         // siempre sera ejecutado
                    //     });

                    if ($("#cbx-47").prop("checked")) {
                        Recurrencia = 1;
                        tipoRecurrencia = $("#eachRecurrencia_input").val();
                        if (tipoRecurrencia == 1) {
                            fechaRecurrenca = $("#fechaCitaRecurrencia").val();
                        } else {
                            fechaRecurrenca = volteaFecha($("#fechaCita").val(), 2);
                            if (tipoRecurrencia == 7 || tipoRecurrencia == 14) {
                                moment(fechaRecurrenca).add(Number(tipoRecurrencia), "days").format("YYYY-MM-DD");
                            } else if (tipoRecurrencia == 30) {
                                moment(fechaRecurrenca).add(Number(1), "month").format("YYYY-MM-DD");
                            }
                        }
                    }

                    nombreCita.replaceAll("'", '"');
                    nombreMascota.replaceAll("'", '"');
                    motivoCita.replaceAll("'", '"');
                    comentariosCita.replaceAll("'", '"');
                    $.ajax({
                        method: "POST",
                        dataType: "JSON",
                        url: url + "Brummy/views/citas/guardarCita.php",
                        data: {
                            FKnombreCita,
                            nombreCita,
                            FKnombreMascota,
                            nombreMascota,
                            fechaCita,
                            horaCita,
                            motivoCita,
                            comentariosCita,
                            FKMotivo,
                            calleDomi,
                            numeroDomi,
                            cpDomi,
                            colDomi,
                            municipioDomi,
                            estadoDomi,
                            domicilio,
                            Recurrencia,
                            tipoRecurrencia,
                            fechaRecurrenca,
                        },
                    })
                        .done(function (results) {
                            let success = results.success;
                            let result = results.result;

                            switch (success) {
                                case true:
                                    $(".sheet-close").trigger("click");
                                    app.dialog.alert("Guardado correctamente", "Aviso");
                                    validaEventos(fechaCita);
                                    app.dialog.close();
                                    break;
                                case false:
                                    // preloader.hide();
                                    msj.show("Aviso", "Algo salió mal", [{ text1: "OK" }]);
                                    break;
                            }
                        })
                        .fail(function (jqXHR, textStatus, errorThrown) {
                            // preloader.hide();
                            msj.show("Aviso", "Algo salió mal", [{ text1: "OK" }]);
                            console.log("error: " + jqXHR.responseText + "\nEstatus: " + textStatus + "\nError: " + errorThrown);
                        });
                }

                function validaEventos(fechaCita) {
                    console.log(fechaCita);
                    let anioCita = String(fechaCita).split("-")[0];
                    let mesCita = String(fechaCita).split("-")[1];
                    let diaCita = String(fechaCita).split("-")[2];

                    let fechaActual = $("#fechaActual").val();

                    let diaActual = String(fechaActual).split("-")[2];
                    let mesActual = String(fechaActual).split("-")[1];
                    let anioActual = String(fechaActual).split("-")[0];

                    let fechaActual1 = anioActual + "-" + mesActual + "-" + diaActual;
                    if (fechaActual1 == fechaCita) {
                        recargaEventosDay(calendar, mesCita, anioCita);
                        cargaEventosMes(calendar, fechaCita);
                    } else {
                        if (mesCita == mesActual && anioActual == anioCita) {
                            // cargaBolitasCalendar();
                            console.log("dar solution");
                        }
                    }
                }
            },
        },
    };
</script>
